name: Build & Test Zephyr Driver

on:
  workflow_call:
    inputs:
      application:
        required: false
        type: string
        default: "sample"
      board:
        required: false
        type: string
      container:
        required: false
        type: string
        default: "zephyrprojectrtos/ci"
      extra_cmd:
        required: false
        type: string
        description: "Extra command to run before build"
        default: ""
    secrets:
      personal_access_token:
        required: true

jobs:
  pre-commit:
    uses: catie-aq/generic_workflows/.github/workflows/pre-commit.yaml@main
  build:
    runs-on: self-hosted
    container: ${{ inputs.container }}
    env:
      CMAKE_PREFIX_PATH: /opt/toolchains
    steps:
      - uses: catie-aq/zephyr_workflows/generate_manifest@7-create-cicd-for-zephyr-driver
        with:
          application: ${{ inputs.application }}
          board: ${{ inputs.board }}
