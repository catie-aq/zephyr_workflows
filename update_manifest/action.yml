# action.yaml
name: "Update Zephyr Manifest"
description: "Update Zephyr manifest with the latest module SHA"

inputs:
  manifest:
    description: "Path to the manifest file"
    required: true
  personal_access_token:
    description: "Personal Access Token for GitHub"
    required: true

outputs:
  update:
    description: "Module SHA update status"
    value: ${{ steps.update.outputs.update }}

runs:
  using: "composite"
  steps:
    - name: Install Poetry
      run: |
        cd ${GITHUB_ACTION_PATH}
        pip install poetry
        poetry install
      shell: bash
    - name: Perform Update
      id: update
      run: | 
        cd ${GITHUB_ACTION_PATH}
        poetry run update --manifest ${{ inputs.manifest }} --token ${{ inputs.personal_access_token }}
        echo "::set-output name=update::${GITHUB_ACTION_PATH}/folder/change.md"
      shell: bash
    - name: Clean up
      if: always()
      run: |
        rm -rf ${GITHUB_ACTION_PATH}
      shell: bash
